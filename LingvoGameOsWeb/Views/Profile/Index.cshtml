@model UserViewModel

@{
    ViewData["Title"] = $"Профиль {Model.Name} {Model.Surname}";
}

<div class="content__row">
    <aside class="content__sidebar">
        <!-- Профиль пользователя -->
        <div class="profile">
            <h3 class="profile__title">Профиль пользователя</h3>
            <div class="profile__avatar">
                <div class="profile__avatar-wrapper">
                    @if (Model.AvatarImgPath != null)
                    {
                        <img src="@Model.AvatarImgPath" alt="Аватар пользователя" class="profile__image">
                    }
                    else
                    {
                        <img src="/img/avatar100.png" alt="Аватар пользователя" class="profile__image">
                    }
                </div>
            </div>
            <form class="profile__form">
                <div class="profile__field">
                    <label class="profile__label" for="firstName">Имя</label>
                    <input type="text" class="profile__input" id="firstName" value="@Model.Name" disabled>
                </div>
                <div class="profile__field">
                    <label class="profile__label" for="lastName">Фамилия</label>
                    <input type="text" class="profile__input" id="lastName" value="@Model.Surname" disabled>
                </div>
                <div class="profile__field">
                    <label class="profile__label" for="email">Email</label>
                    <input type="email" class="profile__input" id="email" value="@Model.UserName" disabled>
                </div>
                <div class="profile__field">
                    <label class="profile__label" for="level">Уровень</label>
                    <input type="text" class="profile__input" id="level" value="1 (static)" disabled>
                </div>
                <div class="profile__field profile__field--bio">
                    <label class="profile__label" for="bio">О себе</label>
                    <textarea class="profile__input profile__textarea" id="bio" placeholder="Расскажите о себе" disabled>@Model.Description</textarea>
                </div>
                @if (Model.IsMyProfile)
                {
                    <a type="button" class="profile__button" asp-controller="Profile" asp-action="Settings" asp-route-userId="@Model.Id">
                        Изменить профиль
                    </a>
                }
            </form>
        </div>
        <!-- Прогресс уровней -->
        <div class="level-progress">
            <h3 class="level-progress__title">Прогресс уровней</h3>
            <div class="level-progress__overview">
                <span class="level-progress__total">Всего баллов: 450</span>
                <span class="level-progress__to-next">До следующего уровня: 50</span>
            </div>
            <div class="level-progress__bar">
                <div class="level-progress__fill" style="width: 90%;"></div>
            </div>
            <div class="level-progress__levels">
                <div class="level-progress__level" data-tooltip="0-300 баллов"
                     data-description="«Барашек, который пытается говорить» – начинаешь издавать осмысленные звуки, но пока не всё понятно.">
                    1. Барашек, который пытается говорить
                </div>
                <div class="level-progress__level active" data-tooltip="300-600 баллов"
                     data-description="«Юный нарт» – уже умеешь составлять предложения и понимаешь базовые правила языка.">
                    2. Юный нарт
                </div>
                <div class="level-progress__level" data-tooltip="600-900 баллов"
                     data-description="«Кавказский орёл» – уверенно говоришь, строишь сложные фразы и можешь поддержать разговор.">
                    3. Кавказский орёл
                </div>
                <div class="level-progress__level" data-tooltip="900-1200 баллов"
                     data-description="«Старейшина, который говорит тосты» – свободно владеешь языком, понимаешь тонкости и культурные нюансы, можешь красиво говорить и даже вести застольные беседы.">
                    4. Старейшина, который говорит тосты
                </div>
                <div class="level-progress__level" data-tooltip="1200+ баллов"
                     data-description="«Хранитель языка» – ты достиг вершины мастерства, твой язык – как песня гор, а слова – как мудрость веков.">
                    5. Хранитель языка
                </div>
            </div>
        </div>
        <!-- Новый блок: Прогресс изучения языка -->
        <div class="language-progress">
            <h3 class="language-progress__title">Прогресс изучения</h3>
            <div class="language-progress__item">
                <span class="language-progress__label">Словарный запас</span>
                <div class="language-progress__bar">
                    <div class="language-progress__fill" style="width: 60%;"></div>
                </div>
                <span class="language-progress__value">60%</span>
            </div>
            <div class="language-progress__item">
                <span class="language-progress__label">Грамматика</span>
                <div class="language-progress__bar">
                    <div class="language-progress__fill" style="width: 45%;"></div>
                </div>
                <span class="language-progress__value">45%</span>
            </div>
            <div class="language-progress__item">
                <span class="language-progress__label">Аудирование</span>
                <div class="language-progress__bar">
                    <div class="language-progress__fill" style="width: 30%;"></div>
                </div>
                <span class="language-progress__value">30%</span>
            </div>
        </div>
    </aside>
    <section class="content__main">
        <!-- Блок общей активности -->
        <div class="activity">
            <h3 class="activity__title">Общая активность</h3>
            <div class="activity__chart">
                <div class="activity__chart-grid">
                    <!-- 365 ячеек для года, сгенерированных для примера -->
                    <div class="activity__chart-cell"></div>
                    <div class="activity__chart-cell active"></div>
                    <div class="activity__chart-cell"></div>
                    <div class="activity__chart-cell active"></div>
                    <div class="activity__chart-cell"></div>
                    <div class="activity__chart-cell active"></div>
                    <div class="activity__chart-cell"></div>
                    <div class="activity__chart-cell"></div>
                    <div class="activity__chart-cell active"></div>
                    <div class="activity__chart-cell"></div>
                    <!-- Повторяется до 365 -->
                </div>
                <div class="activity__chart-labels">
                    <span>янв.</span><span>фев.</span><span>мар.</span><span>апр.</span>
                    <span>май</span><span>июн.</span><span>июл.</span><span>авг.</span>
                    <span>сен.</span><span>окт.</span><span>ноя.</span><span>дек.</span>
                </div>
            </div>
            <div class="activity__stats">
                <div class="activity__stat">
                    <span class="activity__stat-value">65</span>
                    <span class="activity__stat-label">активных дней с момента регистрации</span>
                </div>
                <div class="activity__stat">
                    <span class="activity__stat-value">363</span>
                    <span class="activity__stat-label">балла заработано</span>
                </div>
                <div class="activity__stat">
                    <span class="activity__stat-value">5</span>
                    <span class="activity__stat-label">игр пройдено</span>
                </div>
            </div>
        </div>
        <!-- Блок добавленных пользователем игр -->
        <div class="games-block">
            <!-- Блок добавленных пользователем игр -->
            <section class="user-added-games">
                <header class="user-added-games__header">
                    <h3 class="user-added-games__title">Созданные игры</h3>
                    <div class="user-added-games__controls">
                        @if (Model.IsMyProfile)
                        {
                            <a type="button" class="user-added-games__upload-button" asp-controller="Game" asp-action="Upload">Загрузить игру</a>
                        }
                        @if (Model.DevGames != null && Model.DevGames.Any())
                        {
                            <div class="carousel-controls">
                                <button class="carousel-control carousel-control--prev user-added-games__prev" aria-label="Предыдущие игры">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </button>
                                <span class="carousel-page-counter user-added-games__page-counter">1 из 1</span>
                                <button class="carousel-control carousel-control--next user-added-games__next" aria-label="Следующие игры">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </button>
                            </div>
                        }
                    </div>
                </header>
                @if ((Model.DevGames != null && Model.DevGames.Any()) || (Model.DevPendingGames != null && Model.DevPendingGames.Any()))
                {
                    <div class="user-added-games__carousel">
                        <div class="user-added-games__list">
                            @foreach (var game in Model.DevGames!)
                            {
                                <article class="user-added-games__item">
                                    <a asp-area="" asp-controller="Game" asp-action="Details" asp-route-idGame="@game.Id" class="user-added-games__link">
                                        <img src="@(game.CoverImagePath ?? "/img/default-game.png")" alt="Обложка @game.Title" class="user-added-games__image" loading="lazy">
                                        <div class="user-added-games__content">
                                            <h4 class="user-added-games__name">@game.Title</h4>
                                            <div class="user-added-games__stats">
                                                <span class="user-added-games__rating">
                                                    <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                                                    <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                                                    <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                                                    <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                                                    <img src="/icon/shape.svg" alt="star" class="rating-star"> @game.RaitingPlayers
                                                </span>
                                                <span class="user-added-games__likes">
                                                    <img src="/icon/like2.svg" alt="like" class="stat-icon"> 0
                                                </span>
                                                <span class="user-added-games__views">
                                                    <img src="/icon/eye.svg" alt="view" class="stat-icon"> 130
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                    <div class="user-added-games__actions">
                                        @if (game.GamePlatform.Name == "Desktop")
                                        {
                                            <a role="button" href="@game.GameURL" download class="user-added-games__button">Скачать</a>
                                        }
                                        else
                                        {
                                            <a role="button" asp-area="" asp-controller="Game" asp-action="Start" asp-route-idGame="@game.Id" class="user-added-games__button">Играть</a>
                                        }
                                        @if (Model.IsMyProfile)
                                        {
                                            <a href="#" class="user-added-games__button user-added-games__button--secondary">Аналитика</a>
                                            <a href="#" class="user-added-games__button user-added-games__button--icon" title="Редактировать">
                                                <img src="/icon/edit.svg" alt="Редактировать" class="user-added-games__edit-icon">
                                            </a>
                                        }
                                    </div>
                                </article>
                            }
                            @if (Model.IsMyProfile)
                            {
                                @foreach (var pendingGame in Model.DevPendingGames!)
                                {
                                    <article class="user-added-games__item">
                                        <div class="user-added-games__link">
                                            <img src="@(pendingGame.CoverImagePath ?? "/img/default-game.png")" alt="Обложка @pendingGame.Title" class="user-added-games__image" loading="lazy">
                                            <div class="pending-game-card__status">На модерации</div>
                                            <div class="user-added-games__content">
                                                <h4 class="user-added-games__name">@pendingGame.Title</h4>
                                            </div>
                                        </div>
                                        <div class="user-added-games__actions">
                                            @if (pendingGame.GamePlatform.Name == "Desktop")
                                            {
                                                <a role="button" href="@pendingGame.GameURL" download class="user-added-games__button">Скачать</a>
                                            }
                                            else
                                            {
                                                <button disabled class="user-added-games__button">На модерации</button>
                                            }
                                            @if (Model.IsMyProfile)
                                            {
                                                <a href="#" class="user-added-games__button user-added-games__button--secondary">Аналитика</a>
                                                <a href="#" class="user-added-games__button user-added-games__button--icon" title="Редактировать">
                                                    <img src="/icon/edit.svg" alt="Редактировать" class="user-added-games__edit-icon">
                                                </a>
                                            }
                                        </div>
                                    </article>
                                }
                            }
                        </div>
                    </div>
                }
                else
                {
                    <div class="user-added-games__empty">
                        <p class="user-added-games__empty-text">Создайте свою первую игру!</p>
                        @if (User.IsInRole(Constants.DevRoleName))
                        {
                            <a type="button" asp-area="" asp-controller="Game" asp-action="Upload" class="user-added-games__upload-button">Создать игру</a>
                        }
                    </div>
                }
            </section>

            <!-- Recent Games Block -->
            <section class="recent-games">
                <header class="recent-games__header">
                    <h3 class="recent-games__title">Недавние игры</h3>
                    <div class="recent-games__controls">
                        <a href="#" class="recent-games__view-all-button">Посмотреть все</a>
                        @{
                            var placeholderGames = new[]
                            {
                                                new { Id = 1, Title = "Словарный Бой", Description = "Изучайте слова с удовольствием.", CoverImageURL = "/img/game1.png" },
                                                new { Id = 2, Title = "Грамматический Штурм", Description = "Практикуйте грамматику весело.", CoverImageURL = "/img/game2.png" },
                                                new { Id = 3, Title = "Уши на Макушке", Description = "Тренируйте аудирование.", CoverImageURL = "/img/game3.png" },
                                                new { Id = 4, Title = "Уши на Макушке", Description = "Тренируйте аудирование.", CoverImageURL = "/img/game3.png" }
                                                };
                        }
                        @if (placeholderGames.Any())
                        {
                            <div class="carousel-controls">
                                <button class="carousel-control carousel-control--prev recent-games__prev" aria-label="Предыдущие игры">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </button>
                                <span class="carousel-page-counter recent-games__page-counter">1 из 1</span>
                                <button class="carousel-control carousel-control--next recent-games__next" aria-label="Следующие игры">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </button>
                            </div>
                        }
                    </div>
                </header>
                @if (placeholderGames.Any())
                {
                    <div class="recent-games__carousel">
                        <div class="recent-games__list">
                            @foreach (var game in placeholderGames)
                            {
                                <article class="recent-games__item">
                                    <a asp-area="" asp-controller="Game" asp-action="Start" asp-route-idGame="@game.Id" class="recent-games__link">
                                        <img src="@game.CoverImageURL" alt="Обложка @game.Title" class="recent-games__image" loading="lazy">
                                        <div class="recent-games__content">
                                            <h4 class="recent-games__name">@game.Title</h4>
                                            <p class="recent-games__description">@game.Description</p>
                                            <p class="recent-games__score">Баллы: 0</p>
                                        </div>
                                    </a>
                                </article>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <div class="recent-games__empty">
                        <p class="recent-games__empty-text">Откройте новые игры для изучения!</p>
                        <a href="/games" class="recent-games__button">Найти игры</a>
                    </div>
                }
            </section>
        </div>
    </section>
</div>
<!-- Блок рейтинга в играх -->
<div class="game-stats">
    <h3 class="game-stats__title">Рейтинг в играх</h3>
    <div class="game-stats__list">
        <div class="game-stats__item">
            <span class="game-stats__name">"Игра 1: Словарный Бой"</span>
            <span class="game-stats__points">Баллы: 1200</span>
            <span class="game-stats__ranking">Рейтинг: 1523</span>
            <span class="game-stats__level">Уровень: 3</span>
            <a href="#" class="game-stats__leaderboard-link">Таблица лидеров</a>
        </div>
        <div class="game-stats__item">
            <span class="game-stats__name">"Игра 2: Грамматический Штурм"</span>
            <span class="game-stats__points">Баллы: 900</span>
            <span class="game-stats__ranking">Рейтинг: 1345</span>
            <span class="game-stats__level">Уровень: 2</span>
            <a href="#" class="game-stats__leaderboard-link">Таблица лидеров</a>
        </div>
        <div class="game-stats__item">
            <span class="game-stats__name">"Игра 3: Уши на Макушке"</span>
            <span class="game-stats__points">Баллы: 600</span>
            <span class="game-stats__ranking">Рейтинг: 987</span>
            <span class="game-stats__level">Уровень: 1</span>
            <a href="#" class="game-stats__leaderboard-link">Таблица лидеров</a>
        </div>
    </div>
</div>

<!-- Рекомендуемые игры -->
<div class="recommended-games">
    <h3 class="recommended-games__title">Рекомендуемые игры</h3>
    <div class="recommended-games__list">
        <div class="recommended-games__item">
            <img src="/img/game1.png" alt="Игра" class="recommended-games__image">
            <div class="recommended-games__content">
                <h4 class="recommended-games__name">"Название игры"</h4>
                <div class="recommended-games__stats">
                    <span class="recommended-games__rating">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star"> 4.5
                    </span>
                    <span class="recommended-games__likes">
                        <img src="/icon/like2.svg" alt="like" class="stat-icon"> 1.5K
                    </span>
                    <span class="recommended-games__views">
                        <img src="/icon/eye.svg" alt="view" class="stat-icon"> 2.5K
                    </span>
                </div>
            </div>
        </div>
        <div class="recommended-games__item">
            <img src="/img/game2.png" alt="Игра" class="recommended-games__image">
            <div class="recommended-games__content">
                <h4 class="recommended-games__name">"Название игры"</h4>
                <div class="recommended-games__stats">
                    <span class="recommended-games__rating">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star"> 4.5
                    </span>
                    <span class="recommended-games__likes">
                        <img src="/icon/like2.svg" alt="like" class="stat-icon"> 1.5K
                    </span>
                    <span class="recommended-games__views">
                        <img src="/icon/eye.svg" alt="view" class="stat-icon"> 2.5K
                    </span>
                </div>
            </div>
        </div>
        <div class="recommended-games__item">
            <img src="/img/game2.png" alt="Игра" class="recommended-games__image">
            <div class="recommended-games__content">
                <h4 class="recommended-games__name">"Название игры"</h4>
                <div class="recommended-games__stats">
                    <span class="recommended-games__rating">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star"> 4.5
                    </span>
                    <span class="recommended-games__likes">
                        <img src="/icon/like2.svg" alt="like" class="stat-icon"> 1.5K
                    </span>
                    <span class="recommended-games__views">
                        <img src="/icon/eye.svg" alt="view" class="stat-icon"> 2.5K
                    </span>
                </div>
            </div>
        </div>

        <div class="recommended-games__item">
            <img src="/img/game2.png" alt="Игра" class="recommended-games__image">
            <div class="recommended-games__content">
                <h4 class="recommended-games__name">"Название игры"</h4>
                <div class="recommended-games__stats">
                    <span class="recommended-games__rating">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape2.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star filled">
                        <img src="/icon/shape.svg" alt="star" class="rating-star"> 4.5
                    </span>
                    <span class="recommended-games__likes">
                        <img src="/icon/like2.svg" alt="like" class="stat-icon"> 1.5K
                    </span>
                    <span class="recommended-games__views">
                        <img src="/icon/eye.svg" alt="view" class="stat-icon"> 2.5K
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for editing profile -->
<div class="custom-modal" id="edit-profile-modal">
    <div class="modal__content">
        <button class="modal__close" id="close-edit-modal" aria-label="Закрыть модальное окно">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <h2 class="modal__title">Редактировать профиль</h2>
        <form class="modal__form" id="edit-profile-form" enctype="multipart/form-data">
            <div class="modal__field">
                <label class="modal__label" for="modal-avatar">Аватар</label>
                <div class="modal__avatar-wrapper">
                    <img src="@(Model.AvatarImgPath ?? "/img/avatar100.png")" alt="Аватар пользователя" class="modal__avatar-image" id="modal-avatar-preview">
                    <input type="file" class="modal__avatar-input" id="modal-avatar" accept="image/*">
                    <label for="modal-avatar" class="modal__upload-button">Загрузить новое фото</label>
                </div>
            </div>
            <div class="modal__field">
                <label class="modal__label" for="modal-firstName">Имя</label>
                <input type="text" class="modal__input" id="modal-firstName" value="@Model.Name" required>
            </div>
            <div class="modal__field">
                <label class="modal__label" for="modal-lastName">Фамилия</label>
                <input type="text" class="modal__input" id="modal-lastName" value="@Model.Surname" required>
            </div>
            <div class="modal__field">
                <label class="modal__label" for="modal-email">Email</label>
                <input type="email" class="modal__input" id="modal-email" value="@Model.UserName" required>
            </div>
            <div class="modal__field">
                <label class="modal__label" for="modal-bio">О себе</label>
                <textarea class="modal__input modal__textarea" id="modal-bio" placeholder="Расскажите о себе">@Model.Description</textarea>
            </div>
            <div class="modal__actions">
                <button type="button" class="modal__button modal__button--secondary" id="cancel-edit">Отмена</button>
                <button type="submit" class="modal__button modal__button--primary" id="save-profile">Сохранить</button>
            </div>
            <div class="modal__error" id="modal-error" style="display: none;"></div>
        </form>
    </div>
</div>
@* <script type="module" src="/js/script.js"></script> *@