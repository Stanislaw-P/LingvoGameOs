@model GameViewModel

@{
    ViewData["Title"] = Model.Title;
}

<link rel="stylesheet" href="/css/modal-windows.css" />

<!-- Главный баннер игры с каруселью -->
<section class="game-hero" data-game-id="game1">
    <div class="game-hero__text">
        <h1 class="game-hero__main-title">@Model.Title</h1>
        <p class="game-hero__main-description">
            @Model.Description
        </p>
    </div>
    <div class="game-hero__content">
        <div class="game-hero__carousel">
            <div class="game-hero__slides" style="display: flex; overflow: hidden;">
                @if (Model.ImagesPaths != null)
                {
                    <!-- Элементы карусели (скрины игр)-->
                    @foreach (var imgUrl in Model.ImagesPaths)
                    {
                        <div class="game-hero__slide">
                            <img src="@imgUrl" alt="Game screenshot"
                                 class="game-hero__slide-image">
                        </div>
                    }
                }

                @if (Model.VideoUrl != null)
                {
                    <!-- Видео с Rutube -->
                    <div class="game-hero__slide game-hero__video-slide">
                        <iframe width="720" height="405" src="@Model.VideoUrl" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
                    </div>
                }
            </div>
            <!-- Навигационные кнопки -->
            <button class="game-hero__carousel-button game-hero__carousel-prev">
                <img src="/icon/prev.svg" alt="Previous">
            </button>
            <button class="game-hero__carousel-button game-hero__carousel-next">
                <img src="/icon/next.svg" alt="Next">
            </button>
            <!-- Индикаторы (обновлены на полоски) -->
            <div class="game-hero__carousel-indicators">
                <span class="game-hero__indicator active"></span>
                <span class="game-hero__indicator"></span>
                <span class="game-hero__indicator"></span>
                <span class="game-hero__indicator"></span>
            </div>
        </div>
        <div class="game-hero__info">
            <h1 class="game-hero__title">@Model.Title</h1>
            <div class="game-hero__actions">
                @if (Model.GamePlatform.Name == "Desktop")
                {
                    <a role="button" href="@Model.GameFilePath" download class="game-hero__button profile__button download-btn">
                        <img src="/icon/play.svg" alt="Download" class="game-hero__play-icon"> Скачать
                    </a>
                }
                else
                {
                    <a role="button" asp-controller="Game" asp-action="Start" asp-route-IdGame="@Model.Id" class="game-hero__button profile__button">
                        <img src="/icon/play.svg" alt="Play" class="game-hero__play-icon"> Играть
                    </a>
                }

                @if (User.Identity?.IsAuthenticated == true)
                {
                    <button data-game-id="@Model.Id" class="game-hero__favorite profile__button @(Model.IsFavorite ? "active" : "")">
                        <img src="@(Model.IsFavorite ? "/icon/like3.svg" : "/icon/like.svg")" alt="Добавить в избранное" class="game-hero__favorite-icon">
                    </button>
                }
                else
                {
                    <a asp-area="" asp-controller="Account" asp-action="Login" class="game-hero__favorite profile__button">
                        <img src="/icon/like.svg" alt="Добавить в избранное" class="game-hero__favorite-icon">
                    </a>
                }

            </div>
        </div>
    </div>
</section>

<!-- Основная информация об игре -->
<section class="game-info">

    <div class="game-info__row">
        <article class="game-info__description">
            <h3 class="game-info__subtitle">Правила</h3>
            <p style="white-space: pre-line" class="game-info__text">
                @Model.Rules
            </p>
        </article>
        <aside class="game-info__metadata">
            <div class="game-info__metadata-item">
                <div class="game-info__metadata-header">
                    <img src="/icon/calendar.svg" alt="Calendar" class="game-info__metadata-icon">
                    <h4 class="game-info__metadata-title">Дата выхода</h4>
                </div>
                <p class="game-info__metadata-value">@Model.PublicationDate.ToString("dd.MM.yyyy")</p>
            </div>
            <div class="game-info__metadata-item">
                <div class="game-info__metadata-header">
                    <img src="/icon/categories.svg" alt="Platform" class="game-info__metadata-icon">
                    <h4 class="game-info__metadata-title">Платформа</h4>
                </div>
                <div class="game-info__metadata-list">
                    <span class="game-info__metadata-tag">@Model.GamePlatform.Name</span>
                </div>
            </div>
            @* <div class="game-info__metadata-item">
                <div class="game-info__metadata-header">
                    <img src="/icon/categories.svg" alt="Categories" class="game-info__metadata-icon">
                    <h4 class="game-info__metadata-title">Развиваемые навыки</h4>
                </div>
                <div class="game-info__metadata-list">
                    @foreach (var gameType in Model.SkillsLearning)
                    {
                        <span class="game-info__metadata-tag">@gameType.Name</span>
                    }
                </div>
            </div>
            <div class="game-info__metadata-item">
                <div class="game-info__metadata-header">
                    <img src="/icon/rating.svg" alt="Rating" class="game-info__metadata-icon">
                    <h4 class="game-info__metadata-title">Рейтинг</h4>
                </div>
                <div class="game-info__ratings">
                    <div class="game-info__rating-group">
                        <h5 class="game-info__rating-title">Игроки</h5>
                        <div class="game-info__rating-details">
                            <div class="game-info__stars">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-half.svg" alt="Half Star" class="game-info__star">
                            </div>
                            <span class="game-info__rating-value">@Model.RaitingPlayers</span>
                        </div>
                    </div>
                    <div class="game-info__rating-group">
                        <h5 class="game-info__rating-title">Учителя</h5>
                        <div class="game-info__rating-details">
                            <div class="game-info__stars">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-filled.svg" alt="Star" class="game-info__star">
                                <img src="/icon/star-empty.svg" alt="Empty Star" class="game-hero__star">
                            </div>
                            <span class="game-info__rating-value">@Model.RaitingTeachers</span>
                        </div>
                    </div>
                </div>
            </div> *@

            <div class="game-info__metadata-item">
                <h4 class="game-info__metadata-title">Разработчик</h4>
                <a asp-controller="Profile" asp-action="index" asp-route-userId="@Model.Author.Id">
                    <div class="game-info__developer">
                        <img src="@Model.Author.AvatarImgPath" alt="@Model.Author.Name"
                             class="game-info__developer-avatar">
                        <div class="game-info__developer-details">
                            <span class="game-info__developer-name">@Model.Author.Name @Model.Author.Surname</span>
                            <span class="game-info__developer-games">Количество игр: @Model.Author?.DevGames?.Count</span>
                        </div>
                    </div>
                </a>
            </div>

            @* <a href="#" class="game-info__leaderboard profile__button">
                Таблица
                лидеров
            </a> *@
        </aside>
    </div>
</section>

<!-- Модальное окно подтверждения скачивания -->
<div id="downloadModal" class="modal download-modal" style="display: none;">
    <div class="modal__content download-modal__content">
        <button class="modal__close download-modal__close" type="button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>

        <div class="download-modal__header">
            <h3 class="download-modal__title">Подтверждение скачивания</h3>
        </div>

        <div class="download-modal__body">
            <div class="download-modal__icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="var(--accent-2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M7 10L12 15L17 10" stroke="var(--accent-2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M12 15V3" stroke="var(--accent-2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <p class="download-modal__message">Вы собираетесь скачать игру, которую можно запустить только на компьютере. Продолжить?</p>
        </div>

        <div class="download-modal__footer">
            <button type="button" class="download-modal__cancel games__preview">Отмена</button>
            <button type="button" class="download-modal__confirm games__button">Скачать</button>
        </div>
    </div>
</div>

<!-- Отзывы -->
@await Component.InvokeAsync("Reviews", new { isDetailsPage = true, gameId = Model.Id })

@section Scripts {
    <script src="/js/download-handler.js"></script>
}
