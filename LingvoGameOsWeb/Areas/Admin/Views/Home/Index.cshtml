@model AdminViewModel

@{
    ViewData["Title"] = "Админ-панель";
}

@section Styles {
    <link rel="stylesheet" href="/css/admin/admin-panel.css">
}

<!-- Admin Panel Header -->
<div class="admin-header">
    <div class="admin-header__container">
        <div class="admin-header__logo">
            <img src="/img/logo/logo_3.1.svg" alt="Рудзынг" class="admin-header__logo-img">
            <span class="admin-header__title">Панель-игр</span>
        </div>
        <div class="admin-header__user">
            <span class="admin-header__user-name">@Model.Name @Model.Surname</span>
            <span class="admin-header__user-role">Администратор</span>
        </div>
    </div>
</div>

<!-- Admin Dashboard -->
<div class="admin-dashboard">
    <!-- Statistics Cards -->
    <div class="admin-stats">
        <div class="admin-stats__card">
            <div class="admin-stats__icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10,9 9,9 8,9"></polyline>
                </svg>
            </div>
            <div class="admin-stats__content">
                <span class="admin-stats__value">@Model?.ExistingDevGames?.Count(g => g.IsActive)</span>
                <span class="admin-stats__label">Игр на платформе</span>
            </div>
        </div>
        <div class="admin-stats__card">
            <div class="admin-stats__icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                </svg>
            </div>
            <div class="admin-stats__content">
                <span class="admin-stats__value">@Model?.PendingGames?.Count</span>
                <span class="admin-stats__label">На модерации</span>
            </div>
        </div>
        <div class="admin-stats__card">
            <div class="admin-stats__icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
            <div class="admin-stats__content">
                <span class="admin-stats__value">@Model?.NumberDevelopers</span>
                <span class="admin-stats__label">Разработчиков</span>
            </div>
        </div>
    </div>

    <!-- Published Games Section -->
    <div class="admin-section">
        <div class="admin-section__header">
            <h2 class="admin-section__title">Опубликованные игры</h2>
            <div class="admin-section__controls">
                <input type="search" class="admin-search" placeholder="Поиск игр..." id="published-search">
                <select class="admin-select" id="published-sort">
                    <option value="date">По дате</option>
                    <option value="title">По названию</option>
                    <option value="developer">По разработчику</option>
                </select>
            </div>
        </div>

        <div class="admin-games-grid" id="published-games-list">
            @if (Model?.ExistingDevGames != null && Model.ExistingDevGames.Where(g => g.IsActive).Any())
            {
                @foreach (var game in Model.ExistingDevGames.Where(g => g.IsActive))
                {
                    <div class="admin-game-card" id="published-game-@game.Id">
                        <div class="admin-game-card__image">
                            <img src="@(game.CoverImagePath ?? "/img/default-game.png")" alt="@game.Title">
                        </div>
                        <div class="admin-game-card__content">
                            <h3 class="admin-game-card__title">@game.Title</h3>
                            <p class="admin-game-card__developer">@game.Author?.Name @game.Author?.Surname</p>
                            <p class="admin-game-card__date">@game.PublicationDate.ToString("dd.MM.yyyy")</p>
                        </div>
                        <div class="admin-game-card__actions">
                            @if (game.GamePlatform?.Name == "Desktop")
                            {
                                <a href="@game.GameFilePath" download class="admin-btn admin-btn--primary">Скачать</a>
                            }
                            else
                            {
                                <a asp-area="" asp-controller="Game" asp-action="Start" asp-route-idGame="@game.Id" class="admin-btn admin-btn--primary">Играть</a>
                            }
                            <a asp-area="Admin" asp-controller="Game" asp-action="Edit" asp-route-gameId="@game.Id" class="admin-btn admin-btn--secondary">Редактировать</a>
                            @* <button class="admin-btn admin-btn--outline" onclick="openAnalytics(@game.Id)">Аналитика</button> *@
                            <a asp-area="Admin" asp-controller="Game" asp-action="Deactivate" asp-route-gameId="@game.Id" class="admin-btn admin-btn--danger">Скрыть</a>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="admin-empty">
                    <p>Нет опубликованных игр</p>
                </div>
            }
        </div>
    </div>

    <!-- Pending Games Section -->
    <div class="admin-section">
        <div class="admin-section__header">
            <h2 class="admin-section__title">Игры на модерации</h2>
            <div class="admin-section__controls">
                <input type="search" class="admin-search" placeholder="Поиск игр..." id="pending-search">
                <select class="admin-select" id="pending-sort">
                    <option value="date">По дате</option>
                    <option value="title">По названию</option>
                    <option value="developer">По разработчику</option>
                </select>
            </div>
        </div>

        <div class="admin-games-grid">
            @if (Model?.PendingGames != null && Model.PendingGames.Any())
            {
                @foreach (var pendingGame in Model.PendingGames)
                {
                    <div class="admin-game-card admin-game-card--pending" id="pending-game-@pendingGame.Id">
                        <div class="admin-game-card__image">
                            <img src="@(pendingGame.CoverImagePath ?? "/img/default-game.png")" alt="@pendingGame.Title">
                            <div class="admin-game-card__status">На модерации</div>
                        </div>
                        <div class="admin-game-card__content">
                            <h3 class="admin-game-card__title">@pendingGame.Title</h3>
                            <p class="admin-game-card__developer">@pendingGame.Author?.Name @pendingGame.Author?.Surname</p>
                            <p class="admin-game-card__date">@pendingGame.DispatchDate.ToString("dd.MM.yyyy")</p>
                        </div>
                        <div class="admin-game-card__actions">
                            <a asp-area="Admin" asp-controller="PendingGames" asp-action="Details" asp-route-gameId="@pendingGame.Id" class="admin-btn admin-btn--secondary">Детали</a>
                            <button class="admin-btn admin-btn--outline" onclick="openFeedback(@pendingGame.Id)">Обратная связь</button>
                            <button class="admin-btn admin-btn--success" onclick="approveGame(@pendingGame.Id)">Опубликовать</button>
                            <button class="admin-btn admin-btn--danger delete-game-btn"
                                    data-game-id="@pendingGame.Id"
                                    data-game-title="@pendingGame.Title">
                                Удалить
                            </button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="admin-empty">
                    <p>Нет игр на модерации</p>
                </div>
            }
        </div>
    </div>

    <!-- Inactive Games Section -->
    <div class="admin-section">
        <div class="admin-section__header">
            <h2 class="admin-section__title">Неактивные игры</h2>
            <div class="admin-section__controls">
                <input type="search" class="admin-search" placeholder="Поиск игр..." id="inactive-search">
                <select class="admin-select" id="inactive-sort">
                    <option value="date">По дате</option>
                    <option value="title">По названию</option>
                    <option value="developer">По разработчику</option>
                </select>
            </div>
        </div>

        <div class="admin-games-grid">
            @if (Model?.InactiveGames != null && Model.InactiveGames.Any())
            {
                @foreach (var inactiveGame in Model.InactiveGames)
                {
                    <div class="admin-game-card admin-game-card--inactive" id="inactive-game-@inactiveGame.Id">
                        <div class="admin-game-card__image">
                            <img src="@(inactiveGame.CoverImagePath ?? "/img/default-game.png")" alt="@inactiveGame.Title">
                            <div class="admin-game-card__status admin-game-card__status--inactive">Неактивна</div>
                        </div>
                        <div class="admin-game-card__content">
                            <h3 class="admin-game-card__title">@inactiveGame.Title</h3>
                            <p class="admin-game-card__developer">@inactiveGame.Author?.Name @inactiveGame.Author?.Surname</p>
                            <p class="admin-game-card__date">@inactiveGame.PublicationDate.ToString("dd.MM.yyyy")</p>
                        </div>
                        <div class="admin-game-card__actions">
                            <a asp-area="Admin" asp-controller="Game" asp-action="Edit" asp-route-gameId="@inactiveGame.Id" class="admin-btn admin-btn--secondary">Детали</a>
                            <a asp-area="Admin" asp-controller="Game" asp-action="Activate" asp-route-gameId="@inactiveGame.Id" class="admin-btn admin-btn--success">Активировать</a>
                            <a asp-area="Admin" asp-controller="Game" asp-action="DeleteInactive" asp-route-gameId="@inactiveGame.Id" class="admin-btn admin-btn--danger">Удалить</a>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="admin-empty">
                    <p>Нет неактивных игр</p>
                </div>
            }
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div id="feedback-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal__content">
        <button class="admin-modal__close" onclick="closeFeedback()">×</button>
        <div class="admin-modal__header">
            <h2>Обратная связь разработчику</h2>
        </div>

        <input type="hidden" id="feedback-game-id" />

        <div class="admin-modal__body">
            <strong style="color:black" id="feedback-game-infoId"></strong>
            <p style="color: var(--text-primary)" id="feedback-game-title"></p>
            <p style="color: var(--text-primary)" id="feedback-game-author"></p><br />

            <div class="feedback-form">
                <div class="feedback-form__field">
                    <label for="feedback-message">Сообщение</label>
                    <textarea id="feedback-message" placeholder="Введите ваше сообщение разработчику..." rows="6"></textarea>
                </div>
            </div>
        </div>
        <div class="admin-modal__footer">
            <button class="admin-btn admin-btn--outline" onclick="closeFeedback()">Отмена</button>
            <button class="admin-btn admin-btn--primary" onclick="sendFeedback()">Отправить</button>
        </div>
    </div>
</div>

<!-- Analytics Modal -->
<div id="analytics-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal__content">
        <button class="admin-modal__close" onclick="closeAnalytics()">×</button>
        <div class="admin-modal__header">
            <h2>Аналитика игры</h2>
        </div>
        <div class="admin-modal__body">
            <div class="analytics-content">
                <p>Аналитика будет реализована в будущем</p>
            </div>
        </div>
        <div class="admin-modal__footer">
            <button class="admin-btn admin-btn--outline" onclick="closeAnalytics()">Закрыть</button>
        </div>
    </div>
</div>

<!-- Модальное окно подтверждения удаления игры -->
<div id="delete-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal__content">
        <button class="admin-modal__close" onclick="closeDeleteModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>

        <div class="admin-modal__header">
            <h2>Подтверждение удаления</h2>
        </div>

        <div class="admin-modal__body">
            <div class="delete-modal__content">
                <div class="delete-modal__icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20"
                              stroke="var(--error-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="delete-modal__text">
                    <h3 class="delete-modal__title">Вы уверены, что хотите удалить игру?</h3>
                    <p class="delete-modal__message">Игра "<span id="delete-game-title"></span>" будет полностью удалена из системы. Это действие нельзя отменить.</p>
                    <div class="delete-modal__warning">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 9V11M12 15H12.01M5.07183 19H18.9282C20.4678 19 21.4301 17.3333 20.6603 16L13.7321 4C12.9623 2.66667 11.0377 2.66667 10.2679 4L3.33975 16C2.56995 17.3333 3.53223 19 5.07183 19Z"
                                  stroke="var(--error-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <span>Это действие приведет к безвозвратному удалению всех данных игры</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-modal__footer">
            <button type="button" class="admin-btn admin-btn--secondary" onclick="closeDeleteModal()">Отмена</button>
            <button type="button" class="admin-btn admin-btn--danger" id="confirm-delete-btn" onclick="confirmDeleteGame()">
                Удалить игру
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script src="/js/admin/admin-panel.js" type="module"></script>
}