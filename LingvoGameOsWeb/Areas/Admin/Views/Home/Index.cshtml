@model AdminViewModel

@{
    ViewData["Title"] = "Админ-панель LingvoGameOS";
}

<!-- Admin Panel Header -->
<div class="admin-header">
    <div class="admin-header__container">
        <div class="admin-header__logo">
            <img src="/img/Logo.png" alt="LingvoGameOS" class="admin-header__logo-img">
            <span class="admin-header__title">Админ-панель</span>
        </div>
        <div class="admin-header__user">
            <span class="admin-header__user-name">@Model.Name @Model.Surname</span>
            <span class="admin-header__user-role">Администратор</span>
        </div>
    </div>
</div>

<!-- Admin Dashboard -->
<div class="admin-dashboard">
    <!-- Statistics Cards -->
    <div class="admin-stats">
        <div class="admin-stats__card">
            <div class="admin-stats__icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10,9 9,9 8,9"></polyline>
                </svg>
            </div>
            <div class="admin-stats__content">
                <span class="admin-stats__value">@Model?.ExistingDevGames?.Count</span>
                <span class="admin-stats__label">Игр на платформе</span>
            </div>
        </div>
        <div class="admin-stats__card">
            <div class="admin-stats__icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                </svg>
            </div>
            <div class="admin-stats__content">
                <span class="admin-stats__value">@Model?.PendingGames?.Count</span>
                <span class="admin-stats__label">На модерации</span>
            </div>
        </div>
        <div class="admin-stats__card">
            <div class="admin-stats__icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
            <div class="admin-stats__content">
                <span class="admin-stats__value">@Model?.ExistingDevGames?.Count</span>
                <span class="admin-stats__label">Разработчиков</span>
            </div>
        </div>
    </div>

    <!-- Published Games Section -->
    <div class="admin-section">
        <div class="admin-section__header">
            <h2 class="admin-section__title">Опубликованные игры</h2>
            <div class="admin-section__controls">
                <input type="search" class="admin-search" placeholder="Поиск игр..." id="published-search">
                <select class="admin-select" id="published-sort">
                    <option value="date">По дате</option>
                    <option value="title">По названию</option>
                    <option value="developer">По разработчику</option>
                </select>
            </div>
        </div>
        
        <div class="admin-games-grid">
            @if (Model?.ExistingDevGames != null && Model.ExistingDevGames.Any())
            {
                @foreach (var game in Model.ExistingDevGames)
                {
                    <div class="admin-game-card">
                        <div class="admin-game-card__image">
                            <img src="@(game.CoverImagePath ?? "/img/default-game.png")" alt="@game.Title">
                        </div>
                        <div class="admin-game-card__content">
                            <h3 class="admin-game-card__title">@game.Title</h3>
                            <p class="admin-game-card__developer">@game.Author?.Name @game.Author?.Surname</p>
                            <p class="admin-game-card__date">@game.PublicationDate.ToString("dd.MM.yyyy")</p>
                        </div>
                        <div class="admin-game-card__actions">
                            @if (game.GamePlatform?.Name == "Desktop")
                            {
                                <a href="@game.GameURL" download class="admin-btn admin-btn--primary">Скачать</a>
                            }
                            else
                            {
                                <a href="@Url.Action("Start", "Game", new { idGame = game.Id })" class="admin-btn admin-btn--primary">Играть</a>
                            }
                            <button class="admin-btn admin-btn--secondary" onclick="openGameDetails(@game.Id)">Редактировать</button>
                            <button class="admin-btn admin-btn--outline" onclick="openAnalytics(@game.Id)">Аналитика</button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="admin-empty">
                    <p>Нет опубликованных игр</p>
                </div>
            }
        </div>
    </div>

    <!-- Pending Games Section -->
    <div class="admin-section">
        <div class="admin-section__header">
            <h2 class="admin-section__title">Игры на модерации</h2>
            <div class="admin-section__controls">
                <input type="search" class="admin-search" placeholder="Поиск игр..." id="pending-search">
                <select class="admin-select" id="pending-sort">
                    <option value="date">По дате</option>
                    <option value="title">По названию</option>
                    <option value="developer">По разработчику</option>
                </select>
            </div>
        </div>
        
        <div class="admin-games-grid">
            @if (Model?.PendingGames != null && Model.PendingGames.Any())
            {
                @foreach (var game in Model.PendingGames)
                {
                    <div class="admin-game-card admin-game-card--pending">
                        <div class="admin-game-card__image">
                            <img src="@(game.CoverImagePath ?? "/img/default-game.png")" alt="@game.Title">
                            <div class="admin-game-card__status">На модерации</div>
                        </div>
                        <div class="admin-game-card__content">
                            <h3 class="admin-game-card__title">@game.Title</h3>
                            <p class="admin-game-card__developer">@game.Author?.Name @game.Author?.Surname</p>
                            <p class="admin-game-card__date">@game.DispatchDate.ToString("dd.MM.yyyy")</p>
                        </div>
                        <div class="admin-game-card__actions">
                            <a asp-area="Admin" asp-controller="PendingGames" asp-action="Details" asp-route-gameId="@game.Id" class="admin-btn admin-btn--secondary">Детали</a>
                            <button class="admin-btn admin-btn--outline" onclick="openFeedback(@game.Id)">Обратная связь</button>
                            <button class="admin-btn admin-btn--success" onclick="approveGame(@game.Id)">Опубликовать</button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="admin-empty">
                    <p>Нет игр на модерации</p>
                </div>
            }
        </div>
    </div>
</div>

<!-- Game Details Modal -->
<div id="game-details-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal__content">
        <button class="admin-modal__close" onclick="closeGameDetails()">×</button>
        <div class="admin-modal__header">
            <h2>Детали игры</h2>
        </div>
        <div class="admin-modal__body">
            <div class="game-details">
                <div class="game-details__cover">
                    <img id="modal-game-cover" src="" alt="Обложка игры">
                </div>
                <div class="game-details__info">
                    <div class="game-details__field">
                        <label>Разработчик</label>
                        <input type="text" id="modal-game-developer" readonly>
                    </div>
                    <div class="game-details__field">
                        <label>Название игры</label>
                        <input type="text" id="modal-game-title">
                    </div>
                    <div class="game-details__field">
                        <label>Описание</label>
                        <textarea id="modal-game-description"></textarea>
                    </div>
                    <div class="game-details__field">
                        <label>Правила</label>
                        <textarea id="modal-game-rules"></textarea>
                    </div>
                    <div class="game-details__field">
                        <label>Дата подачи</label>
                        <input type="text" id="modal-game-date" readonly>
                    </div>
                    <div class="game-details__field">
                        <label>Скриншоты</label>
                        <div id="modal-game-screenshots" class="game-screenshots"></div>
                    </div>
                    <div class="game-details__field">
                        <label>Файл игры</label>
                        <a id="modal-game-file" href="#" class="admin-btn admin-btn--primary">Скачать/Играть</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="admin-modal__footer">
            <button class="admin-btn admin-btn--outline" onclick="closeGameDetails()">Отмена</button>
            <button class="admin-btn admin-btn--primary" onclick="saveGameChanges()">Сохранить</button>
            <button class="admin-btn admin-btn--success" id="approve-game-btn" onclick="approveGameFromModal()">Подтвердить игру</button>
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div id="feedback-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal__content">
        <button class="admin-modal__close" onclick="closeFeedback()">×</button>
        <div class="admin-modal__header">
            <h2>Обратная связь разработчику</h2>
        </div>

        <input type="hidden" id="feedback-game-id" />

        <div class="admin-modal__body">
            <strong style="color:black" id="feedback-game-infoId"></strong>
            <p style="color: var(--text-primary)" id="feedback-game-title"></p>
            <p style="color: var(--text-primary)" id="feedback-game-author"></p><br />

            <div class="feedback-form">
                <div class="feedback-form__field">
                    <label for="feedback-message">Сообщение</label>
                    <textarea id="feedback-message" placeholder="Введите ваше сообщение разработчику..." rows="6"></textarea>
                </div>
            </div>
        </div>
        <div class="admin-modal__footer">
            <button class="admin-btn admin-btn--outline" onclick="closeFeedback()">Отмена</button>
            <button class="admin-btn admin-btn--primary" onclick="sendFeedback()">Отправить</button>
        </div>
    </div>
</div>

<!-- Analytics Modal -->
<div id="analytics-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal__content">
        <button class="admin-modal__close" onclick="closeAnalytics()">×</button>
        <div class="admin-modal__header">
            <h2>Аналитика игры</h2>
        </div>
        <div class="admin-modal__body">
            <div class="analytics-content">
                <p>Аналитика будет реализована в будущем</p>
            </div>
        </div>
        <div class="admin-modal__footer">
            <button class="admin-btn admin-btn--outline" onclick="closeAnalytics()">Закрыть</button>
        </div>
    </div>
</div>

<link rel="stylesheet" href="/css/admin/admin-panel.css">
<script src="/js/admin/admin-panel.js"></script>